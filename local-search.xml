<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>防火墙实验</title>
    <link href="/2022/04/26/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/"/>
    <url>/2022/04/26/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="防火墙实验"><a href="#防火墙实验" class="headerlink" title="防火墙实验"></a>防火墙实验</h1><h3 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h3><ol><li>基于Linux虚拟机，安装、配置pfSense<br>a) 设置单层防火墙，限制外部主机访问localhost的全部端口；<br>b) 有条件的情况下，配置双层防火墙模式（一个虚拟机配置mysql，一个作为web服务器，在两者之间尝试设置一个防火墙）；</li><li>安装Snort，与pfSense配合成为IDS工作模式。</li></ol><h3 id="二、实验准备"><a href="#二、实验准备" class="headerlink" title="二、实验准备"></a>二、实验准备</h3><p>首先设计根据实验要求，设计网络拓扑图：</p><p>外部主机：系统为kali，IP地址为<strong>10.0.2.10</strong>，作为模拟外网主机。</p><p>DMZ主机：系统为Debian11，IP地址为<strong>192.168.116.13</strong>，作为web服务器，可被外部访问。</p><p>内部主机：系统为Debian11，IP地址为<strong>192.168.120.13</strong>，作为mysql数据库，仅能被web服务器访问。</p><p>外部防火墙：系统为pfSense，IP地址如下：    </p><ul><li>WAN口：<strong>10.0.2.4</strong></li><li>LAN口：<strong>192.168.116.20</strong>。</li></ul><p>内部防火墙：系统为pfSense，IP地址如下：</p><ul><li>WAN口：<strong>192.168.116.30</strong></li><li>LAN口：<strong>192.168.120.20</strong>。</li></ul><p>具体如图所示：</p><p><img src="../../public/img/firewall/2a10.png" alt="2a10"></p><h3 id="三、实验过程"><a href="#三、实验过程" class="headerlink" title="三、实验过程"></a>三、实验过程</h3><h4 id="1-基于Linux虚拟机，安装、配置pfSense"><a href="#1-基于Linux虚拟机，安装、配置pfSense" class="headerlink" title="1.基于Linux虚拟机，安装、配置pfSense"></a>1.基于Linux虚拟机，安装、配置pfSense</h4><h5 id="1-1-设置单层防火墙，限制外部主机访问localhost的全部端口"><a href="#1-1-设置单层防火墙，限制外部主机访问localhost的全部端口" class="headerlink" title="1.1 设置单层防火墙，限制外部主机访问localhost的全部端口"></a>1.1 设置单层防火墙，限制外部主机访问localhost的全部端口</h5><p>根据教程，安装pfSense，并配置<strong>WAN</strong>和<strong>LAN</strong>的IP地址。IP地址如下：</p><p><img src="../../public/img/firewall/1a1.png" alt="1a1"></p><p>当前pfSense的WAN口设置为：允许外部主机访问<strong>WAN</strong>，如图所示：</p><p><img src="../../public/img/firewall/1a3.png" alt="1a3"></p><p>在<strong>kali</strong>下使用<strong>namp</strong>工具扫描当前开放端口，结果如图所示：</p><p><img src="../../public/img/firewall/1a2.png" alt="1a2"></p><p>在kali下，能成功ping通pfSense或通过SSH远程连接到pfSense：</p><p><img src="../../public/img/firewall/1a4.png" alt="1a4"></p><p><img src="../../public/img/firewall/1a5.png" alt="1a5"></p><p>修改pfSense的<strong>WAN口</strong>的策略规则，<strong>拒绝</strong>所有访问<strong>WAN口</strong>的外部主机：</p><p><img src="../../public/img/firewall/1a6.png" alt="1a6"></p><p>再次尝试用kali访问：</p><p><img src="../../public/img/firewall/1a7.png" alt="1a7"></p><p><img src="../../public/img/firewall/1a8.png" alt="1a8"></p><p>如图所示，kali无法ping通pfSense，无法访问pfSense的22端口。</p><h5 id="1-2-配置双层防火墙模式（一个虚拟机配置mysql，一个作为web服务器，在两者之间尝试设置一个防火墙）"><a href="#1-2-配置双层防火墙模式（一个虚拟机配置mysql，一个作为web服务器，在两者之间尝试设置一个防火墙）" class="headerlink" title="1.2 配置双层防火墙模式（一个虚拟机配置mysql，一个作为web服务器，在两者之间尝试设置一个防火墙）"></a>1.2 配置双层防火墙模式（一个虚拟机配置mysql，一个作为web服务器，在两者之间尝试设置一个防火墙）</h5><p>设置防火墙的规则策略前，对网络的连通性进行测试。</p><p><strong>外网主机kali</strong> 成功ping通DMZ的<strong>web服务器</strong>和内网的<strong>mysql</strong>：</p><p><img src="../../public/img/firewall/2a2.png" alt="2a2"></p><p><img src="../../public/img/firewall/2a3.png" alt="2a2"></p><p>简单编写一个php文件，让<strong>web服务器</strong>连接内网的<strong>mysql</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dbhost</span> = <span class="hljs-string">&#x27;192.168.120.13&#x27;</span>;  <span class="hljs-comment">// mysql服务器主机地址</span><br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&#x27;webserver&#x27;</span>;            <span class="hljs-comment">// mysql用户名</span><br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&#x27;123456&#x27;</span>;          <span class="hljs-comment">// mysql用户名密码</span><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-variable">$dbhost</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpass</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>) &#123;<br>    <span class="hljs-comment">//die(&#x27;Could not connect: &#x27; . mysqli_error());</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;could not connect&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;数据库连接成功！&#x27;</span>;<br>mysqli_close(<span class="hljs-variable">$conn</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>配置<strong>外部防火墙</strong>的规则策略，首先配置WAN口，只<strong>允许外部主机使用TCP、UDP和ICMP协议访问web服务器</strong>：</p><p><img src="../../public/img/firewall/2a6.png" alt="2a6"></p><p>配置LAN口，允许DMZ内的主机能相互访问：</p><p><img src="../../public/img/firewall/2a7.png" alt="2a7"></p><p>配置<strong>内部防火墙</strong>的规则策略，首先配置WAN口：</p><p><img src="../../public/img/firewall/2a8.png" alt="2a8"></p><p>配置LAN口：</p><p><img src="../../public/img/firewall/2a9.png" alt="2a9"></p><p>然后测试防火墙的规则策略是否设置成功。</p><p>首先用外部主机测试ping内网的mysql，无法ping通，说明<strong>外网无法访问内网</strong>：</p><p><img src="../../public/img/firewall/2a12.png" alt="2a12"></p><p>用内网的mysql测试ping外部主机，无法ping通，说明<strong>内网无法访问外网</strong>：</p><p><img src="../../public/img/firewall/2a13.png" alt="2a13"></p><p>用内网的mysql分别尝试ping外部防火墙的LAN口和web服务器，无法ping通LAN口，能ping通web服务器，说明<strong>内网主机只能向指定的DMZ主机发送数据</strong>：</p><p><img src="../../public/img/firewall/2a14.png" alt="2a14"></p><p>用外部主机访问web服务器，显示web服务器成功连接mysql，说明<strong>web服务器能访问内网的mysql</strong>：</p><p><img src="../../public/img/firewall/2a15.png" alt="2a15"></p><p>综上所述，成功配置了双层防火墙模式。</p><h4 id="2-安装Snort，与pfSense配合成为IDS工作模式。"><a href="#2-安装Snort，与pfSense配合成为IDS工作模式。" class="headerlink" title="2. 安装Snort，与pfSense配合成为IDS工作模式。"></a>2. 安装Snort，与pfSense配合成为IDS工作模式。</h4><p>由于pfSense拥有较为丰富的插件，而Snort也在其中，因此选择本实验选择安装插件的方式安装Snort。</p><p>在系统的插件管理中安装Snort插件，此处以提前安装完成：</p><p><img src="../../public/img/firewall/2a1.png" alt="2a1"></p><p>设计情景：编写一个snort规则，当它检测到你的电脑被其他的电脑通过ICMP协议访问，如ping命令，会发出一个警告。</p><p>首先创建一个要被监控的接口，当前情景中是<strong>外部防火墙的WAN口</strong>：</p><p><img src="../../public/img/firewall/3a3.png" alt="3a3"></p><p>编写一条规则，当非DMZ网段和内网网段的主机向内网发送数据时，会警告并记录，具体规则如图所示：</p><p><img src="../../public/img/firewall/3a4.png" alt="3a4"></p><p>重启监控的接口，并尝试用外部主机ping内网的mysql(由于双层防火墙的限制，外部主机ping不通mysql)：</p><p><img src="../../public/img/firewall/3a2.png" alt="3a2"></p><p>查看Snort的log，有警告的记录：</p><p><img src="../../public/img/firewall/3a1.png" alt="3a1"><br>外部主机向内网发送数据被警告并记录，说明规则编写成功。</p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>测试</title>
    <link href="/2021/12/09/%E6%B5%8B%E8%AF%95/"/>
    <url>/2021/12/09/%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/06/08/hello-world/"/>
    <url>/2021/06/08/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
